/*! viewmachine 17-05-2014 */
viewMachine=function(e,t,i){return new viewMachine.init(e,t,i)},viewMachine.init=function(e,t){var i=document.createElement(e);return this.$=i,i.VM=this,this.element=i.tagName,void 0===t&&(t={}),t.id&&(this.id=t.id),this.drawn=!1,this.properties=t,this.children=[],this.events=[],this.style={},this.parent="body",this.type="ViewMachine",this},viewMachine.init.prototype=viewMachine.prototype,window.viewMachine=window.VM=viewMachine;var events=[];viewMachine.prototype.text=function(e){return this.properties.text=e,this.drawn&&this.draw(),this},viewMachine.prototype.getId=function(){return this.id?this.id:""+Math.floor(1e7*Math.random()+1)},viewMachine.prototype.html=function(e){this.drawn||(this.properties.id=this.getId()),e&&(this.drawn=!0);var t=this.$;for(var i in this.properties)"text"===i?t.innerHTML=this.properties[i]:"id"===i?t.id=this.properties[i]:t.setAttribute(i,this.properties[i]);for(var n in this.style)t.style[n]=this.style[n];for(var r=this.children.length,s=0;r>s;s++)t.appendChild(this.children[s].html(e));for(var p in this.events)this.events[p].id=this.properties.id,events.push([this.events[p],this]);return t},viewMachine.prototype.draw=function(){function e(e,t,i,n){viewMachine.addEventListener(document.getElementById(e),t,function(){viewMachine.trigger(i,n)})}if(events=[],this.drawn)this.replace(this.html(!0).outerHTML);else{var t;if("string"==typeof this.parent)t=document.getElementsByTagName(this.parent)[0],t.appendChild(this.html(!0)),this.drawn=!0;else{if(this.parent.drawn!==!0)throw"DrawError: Parent element not on page";t=document.getElementById(this.parent.properties.id),t.appendChild(this.html(!0)),this.drawn=!0}}for(var i=events.length,n=0;i>n;n++)"function"==typeof events[n][0].callback?viewMachine.addEventListener(document.getElementById(events[n][0].id),events[n][0].event,events[n][0].callback):e(events[n][0].id,events[n][0].event,events[n][0].callback,events[n][1]);return this},viewMachine.prototype.event=function(e,t){if(this.events.push({event:e,callback:t}),"function"==typeof t)this.drawn&&viewMachine.addEventListener(document.getElementById(this.properties.id),e,function(e){e.data=this,t(e)});else if("string"==typeof t&&this.drawn){var i=this;viewMachine.addEventListener(document.getElementById(this.properties.id),e,function(){viewMachine.trigger(t,i)})}return this},viewMachine.prototype.remove=function(){if(this.drawn){var e=document.getElementById(this.properties.id);e&&e.parentNode.removeChild(e),this.drawn=!1}else this.properties.id||(this.properties.id=this.getId());if("string"!=typeof this.parent)for(var t=this.parent.children,i=t.length,n=0;i>n;n++)if(t[n].properties.id===this.properties.id)return this.parent.children.splice(n,1),this;return this},viewMachine.prototype.replace=function(e){return this.drawn?(document.getElementById(this.properties.id).outerHTML=e,this):void 0},viewMachine.prototype.hide=function(){if(this.drawn){var e=document.getElementById(this.properties.id);e.parentNode.removeChild(e),this.drawn=!1}return this},viewMachine.prototype.append=function(e){return e.parent=this,this.children.push(e),this.drawn&&e.draw(),this},viewMachine.prototype.mappend=function(e){if("object"==typeof e)for(var t in e)this.append(e[t]);else for(var i=0;e.length>i;i++)this.append(e[i]);return this},viewMachine.prototype.prepend=function(e){return e.parent=this,this.children=[e].concat(this.children),this.drawn&&this.draw(),this},viewMachine.prototype.splice=function(e,t,i){var n;if(i){i.parent=this,n=this.children.splice(e,t,i);try{if(this.drawn&&void 0!==i)if(e>0){var r=document.getElementById(this.children[e-1].properties.id);r?r.insertAdjacentHTML("afterend",i.html(!0).outerHTML):this.append(i),i.drawn=!0}else document.getElementById(this.properties.id).appendChild(i.html(!0)),i.drawn=!0}catch(s){this.parent.draw()}}else n=this.children.splice(e,t);if(this.drawn)for(var p=n.length,h=0;p>h;h++)n[h].remove();return this},viewMachine.prototype.addClass=function(e){var t;return t=this.properties["class"]?this.properties["class"].split(" "):[],-1===t.indexOf(e)&&(t.push(e),this.properties["class"]=t.join(" "),this.drawn&&document.getElementById(this.properties.id).setAttribute("class",this.properties["class"])),this},viewMachine.prototype.removeClass=function(e){var t=this.properties["class"].split(" "),i=t.indexOf(e);return i>=0&&(t.splice(i,1),this.properties["class"]=t.join(" "),this.drawn&&document.getElementById(this.properties.id).setAttribute("class",this.properties["class"])),this},viewMachine.prototype.css=function(e,t){if("string"==typeof e){if(void 0===t)return this.drawn?getComputedStyle(document.getElementById(this.properties.id))[e]:this.style[e]||"";this.style[e]=t,this.drawn&&(document.getElementById(this.properties.id).style[e]=t)}else for(var i in e)this.style[i]=e[i],this.drawn&&(document.getElementById(this.properties.id).style[i]=e[i]);return this},viewMachine.parent=function(e,t,i){var n,r,s=e;if(e.properties&&(r=e.properties,s=e.type),n=new viewMachine.init(s,r),"number"==typeof i)for(var p=0;i>p;p++)n.append(new viewMachine.init(t));else if(Array.isArray(i))for(var h,a=i.length,o=0;a>o;o++)h="object"==typeof i[o]?"ViewMachine"===i[o].type?i[o]:new viewMachine.init(t,i[o]):new viewMachine.init(t,{text:i[o]}),n.append(h);return n},viewMachine.createTemplate=function(e){var t={};if("object"==typeof e&&"ViewMachine"===e.type){if(t.element=e.element,viewMachine.isEmpty(e.style)||(t.style=e.style),void 0!==e.id&&(t.id=e.id),!viewMachine.isEmpty(e.properties))for(var i in e.properties)void 0!==e.properties[i]&&"id"!==i&&(t.properties=t.properties||{},t.properties[i]=e.properties[i]);if(!e.children.length||void 0!==e.preserve&&e.preserve!==!0)e.preserve===!1&&(t.preserve=!1);else{t.children=[];for(var n in e.children)"object"==typeof e&&"ViewMachine"===e.type&&t.children.push(viewMachine.createTemplate(e.children[n]))}if(viewMachine.properties[e.element])for(var r in viewMachine.properties[e.element])"object"==typeof e[viewMachine.properties[e.element][r]]?(t[viewMachine.properties[e.element][r]]=Array.isArray(e[viewMachine.properties[e.element][r]])?[]:{},t[viewMachine.properties[e.element][r]]=viewMachine.extend(t[viewMachine.properties[e.element][r]],e[viewMachine.properties[e.element][r]])):t[viewMachine.properties[e.element][r]]=e[viewMachine.properties[e.element][r]];if(e.events.length){t.events=[];for(var s in e.events)"string"==typeof e.events[s].callback&&t.events.push({event:e.events[s].event,callback:e.events[s].callback})}return t}return!1},viewMachine.construct=function(e){var t;if(e.preserve===!1)t=new(viewMachine[e.element.substring(0,1).toUpperCase()+e.element.substring(1,e.element.length)])(e[viewMachine.properties[e.element][0]],e[viewMachine.properties[e.element][1]],e[viewMachine.properties[e.element][2]],e[viewMachine.types[e.element][3]]);else{if(t="img"===e.element&&"string"==typeof e.preload?new viewMachine.Image(e.src,e.preload,e.properties):new viewMachine.init(e.element,e.properties),viewMachine.properties[t.element])for(var i in viewMachine.properties[t.element])"object"==typeof t[viewMachine.properties[t.element][i]]?(t[viewMachine.properties[t.element][i]]={},viewMachine.extend(t[viewMachine.properties[t.element][i]],e[viewMachine.properties[t.element][i]])):t[viewMachine.properties[t.element][i]]=e[viewMachine.properties[t.element][i]];viewMachine.types[t.element]&&viewMachine.extend(t,viewMachine.types[t.element])}for(var n in e.children)t.append(viewMachine.construct(e.children[n]));return e.style&&(t.style=e.style),void 0!==e.id&&(t.id=e.id),void 0!==e.events&&(t.events=e.events),t},viewMachine.jsonTemplate=function(e){if("string"==typeof e){var t=JSON.parse(e);return viewMachine.construct(t)}return"object"==typeof e&&"ViewMachine"===e.type&&(e=viewMachine.createTemplate(e)),JSON.stringify(e)};