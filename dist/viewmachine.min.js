/*! viewmachine 17-05-2014 */
var events=[];VM.El=function(e,t){return this instanceof VM.El==!1?new VM.El(e,t):(this.element=e,this.$=doc.createElement(e),void 0===t&&(t={}),t.id&&(this.id=t.id),this.drawn=!1,this.properties=t,this.children=[],this.events=[],this.style={},this)},VM.El.prototype={text:function(e){return this.properties.text=e,this.drawn&&this.draw(),this},getId:function(){return this.id?this.id:""+Math.floor(1e7*Math.random()+1)},html:function(e){this.drawn||(this.properties.id=this.getId()),e&&(this.drawn=!0);var t=this.$;for(var i in this.properties)"text"===i?t.innerHTML=this.properties[i]:"id"===i?t.id=this.properties[i]:t.setAttribute(i,this.properties[i]);for(var r in this.style)t.style[r]=this.style[r];for(var s=this.children.length,n=0;s>n;n++)t.appendChild(this.children[n].html(e));for(var p in this.events)this.events[p].id=this.properties.id,events.push([this.events[p],this]);return t},draw:function(){function e(e,t,i,r){VM.addEventListener(doc.getElementById(e),t,function(){VM.trigger(i,r)})}if(events=[],this.drawn)this.replace(this.html(!0).outerHTML);else{var t;if("string"==typeof this.parent)t=doc.getElementsByTagName(this.parent)[0],t.appendChild(this.html(!0)),this.drawn=!0;else{if(this.parent.drawn!==!0)throw"DrawError: Parent element not on page";t=doc.getElementById(this.parent.properties.id),t.appendChild(this.html(!0)),this.drawn=!0}}for(var i=events.length,r=0;i>r;r++)"function"==typeof events[r][0].callback?VM.addEventListener(doc.getElementById(events[r][0].id),events[r][0].event,events[r][0].callback):e(events[r][0].id,events[r][0].event,events[r][0].callback,events[r][1]);return this},event:function(e,t){if(this.events.push({event:e,callback:t}),"function"==typeof t)this.drawn&&VM.addEventListener(doc.getElementById(this.properties.id),e,function(e){e.data=this,t(e)});else if("string"==typeof t&&this.drawn){var i=this;VM.addEventListener(doc.getElementById(this.properties.id),e,function(){VM.trigger(t,i)})}return this},remove:function(){if(this.drawn){var e=doc.getElementById(this.properties.id);e&&e.parentNode.removeChild(e),this.drawn=!1}else this.properties.id||(this.properties.id=this.getId());if("string"!=typeof this.parent)for(var t=this.parent.children,i=t.length,r=0;i>r;r++)if(t[r].properties.id===this.properties.id)return this.parent.children.splice(r,1),this;return this},replace:function(e){return this.drawn?(doc.getElementById(this.properties.id).outerHTML=e,this):void 0},hide:function(){if(this.drawn){var e=doc.getElementById(this.properties.id);e.parentNode.removeChild(e),this.drawn=!1}return this},append:function(e){return e.parent=this,this.children.push(e),this.drawn&&e.draw(),this},mappend:function(e){if("object"==typeof e)for(var t in e)this.append(e[t]);else for(var i=0;e.length>i;i++)this.append(e[i]);return this},prepend:function(e){return e.parent=this,this.children=[e].concat(this.children),this.drawn&&this.draw(),this},splice:function(e,t,i){var r;if(i){i.parent=this,r=this.children.splice(e,t,i);try{if(this.drawn&&void 0!==i)if(e>0){var s=doc.getElementById(this.children[e-1].properties.id);s?s.insertAdjacentHTML("afterend",i.html(!0).outerHTML):this.append(i),i.drawn=!0}else doc.getElementById(this.properties.id).appendChild(i.html(!0)),i.drawn=!0}catch(n){this.parent.draw()}}else r=this.children.splice(e,t);if(this.drawn)for(var p=r.length,o=0;p>o;o++)r[o].remove();return this},addClass:function(e){var t;return t=this.properties["class"]?this.properties["class"].split(" "):[],-1===t.indexOf(e)&&(t.push(e),this.properties["class"]=t.join(" "),this.drawn&&doc.getElementById(this.properties.id).setAttribute("class",this.properties["class"])),this},removeClass:function(e){var t=this.properties["class"].split(" "),i=t.indexOf(e);return i>=0&&(t.splice(i,1),this.properties["class"]=t.join(" "),this.drawn&&doc.getElementById(this.properties.id).setAttribute("class",this.properties["class"])),this},css:function(e,t){if("string"==typeof e){if(void 0===t)return this.drawn?getComputedStyle(doc.getElementById(this.properties.id))[e]:this.style[e]||"";this.style[e]=t,this.drawn&&(doc.getElementById(this.properties.id).style[e]=t)}else for(var i in e)this.style[i]=e[i],this.drawn&&(doc.getElementById(this.properties.id).style[i]=e[i]);return this},parent:"body",type:"ViewMachine"},VM.ParentEl=function(e,t,i){var r,s,n=e;if(e.properties&&(s=e.properties,n=e.type),r=new VM.El(n,s),"number"==typeof i)for(var p=0;i>p;p++)r.append(new VM.El(t));else if(Array.isArray(i))for(var o,h=i.length,d=0;h>d;d++)o="object"==typeof i[d]?"ViewMachine"===i[d].type?i[d]:new VM.El(t,i[d]):new VM.El(t,{text:i[d]}),r.append(o);return r},VM.createTemplate=function(e){var t={};if("object"==typeof e&&"ViewMachine"===e.type){if(t.element=e.element,VM.isEmpty(e.style)||(t.style=e.style),void 0!==e.id&&(t.id=e.id),!VM.isEmpty(e.properties))for(var i in e.properties)void 0!==e.properties[i]&&"id"!==i&&(t.properties=t.properties||{},t.properties[i]=e.properties[i]);if(!e.children.length||void 0!==e.preserve&&e.preserve!==!0)e.preserve===!1&&(t.preserve=!1);else{t.children=[];for(var r in e.children)"object"==typeof e&&"ViewMachine"===e.type&&t.children.push(VM.createTemplate(e.children[r]))}if(VM.properties[e.element])for(var s in VM.properties[e.element])"object"==typeof e[VM.properties[e.element][s]]?(t[VM.properties[e.element][s]]=Array.isArray(e[VM.properties[e.element][s]])?[]:{},t[VM.properties[e.element][s]]=VM.extend(t[VM.properties[e.element][s]],e[VM.properties[e.element][s]])):t[VM.properties[e.element][s]]=e[VM.properties[e.element][s]];if(e.events.length){t.events=[];for(var n in e.events)"string"==typeof e.events[n].callback&&t.events.push({event:e.events[n].event,callback:e.events[n].callback})}return t}return!1},VM.construct=function(e){var t;if(e.preserve===!1)t=new(VM[e.element.substring(0,1).toUpperCase()+e.element.substring(1,e.element.length)])(e[VM.properties[e.element][0]],e[VM.properties[e.element][1]],e[VM.properties[e.element][2]],e[VM.types[e.element][3]]);else{if(t="img"===e.element&&"string"==typeof e.preload?new VM.Image(e.src,e.preload,e.properties):new VM.El(e.element,e.properties),VM.properties[t.element])for(var i in VM.properties[t.element])"object"==typeof t[VM.properties[t.element][i]]?(t[VM.properties[t.element][i]]={},VM.extend(t[VM.properties[t.element][i]],e[VM.properties[t.element][i]])):t[VM.properties[t.element][i]]=e[VM.properties[t.element][i]];VM.types[t.element]&&VM.extend(t,VM.types[t.element])}for(var r in e.children)t.append(VM.construct(e.children[r]));return e.style&&(t.style=e.style),void 0!==e.id&&(t.id=e.id),void 0!==e.events&&(t.events=e.events),t},VM.jsonTemplate=function(e){if("string"==typeof e){var t=JSON.parse(e);return VM.construct(t)}return"object"==typeof e&&"ViewMachine"===e.type&&(e=VM.createTemplate(e)),JSON.stringify(e)},window.viewMachine=window.VM=viewMachine;