/*! viewmachine 18-05-2014 */
function Template(e){this.DOM=e.apply(this)}viewMachine=function(e,i,t){return new viewMachine.init(e,i,t)},viewMachine.init=function(e,i){var t;if(e instanceof HTMLElement==!0){if(t=e,void 0!==t.VM)return t.VM}else t="body"!==e.toLowerCase()?document.createElement(e):document.body;return this.$=t,t.VM=this,this.element=t.tagName,void 0===i&&(i={}),void 0!==i.id&&(t.id=i.id),this.attrs=i,this.events=[],this.style={},this},null===window.onload?window.onload=function(){viewMachine.body=viewMachine(document.body)}:null===document.onload&&(document.onload=function(){viewMachine.body=viewMachine(document.body)}),viewMachine.init.prototype=viewMachine.prototype,window.viewMachine=window.VM=viewMachine,viewMachine.prototype.addClass=function(e){var i;return i=this.properties["class"]?this.properties["class"].split(" "):[],-1===i.indexOf(e)&&(i.push(e),this.properties["class"]=i.join(" "),this.drawn&&document.getElementById(this.properties.id).setAttribute("class",this.properties["class"])),this},viewMachine.prototype.removeClass=function(e){var i=this.properties["class"].split(" "),t=i.indexOf(e);return t>=0&&(i.splice(t,1),this.properties["class"]=i.join(" "),this.drawn&&document.getElementById(this.properties.id).setAttribute("class",this.properties["class"])),this},viewMachine.prototype.css=function(e,i){if("string"==typeof e){if(void 0===i)return this.drawn?getComputedStyle(document.getElementById(this.properties.id))[e]:this.style[e]||"";this.style[e]=i,this.drawn&&(document.getElementById(this.properties.id).style[e]=i)}else for(var t in e)this.style[t]=e[t],this.drawn&&(document.getElementById(this.properties.id).style[t]=e[t]);return this},viewMachine.prototype.parent=function(){return this.$.parentNode},viewMachine.prototype.children=function(){return this.$.children},viewMachine.prototype.remove=function(){if(this.drawn){var e=document.getElementById(this.properties.id);e&&e.parentNode.removeChild(e),this.drawn=!1}else this.properties.id||(this.properties.id=this.getId());if("string"!=typeof this.parent)for(var i=this.parent.children,t=i.length,n=0;t>n;n++)if(i[n].properties.id===this.properties.id)return this.parent.children.splice(n,1),this;return this},viewMachine.prototype.replace=function(e){return this.drawn?(document.getElementById(this.properties.id).outerHTML=e,this):void 0},viewMachine.prototype.hide=function(){if(this.drawn){var e=document.getElementById(this.properties.id);e.parentNode.removeChild(e),this.drawn=!1}return this},viewMachine.prototype.append=function(e){return this.$.appendChild(e.$),this},viewMachine.prototype.mappend=function(e){if("object"==typeof e)for(var i in e)this.append(e[i]);else for(var t=0;e.length>t;t++)this.append(e[t]);return this},viewMachine.prototype.prepend=function(e){return e.parent=this,this.children=[e].concat(this.children),this.drawn&&this.draw(),this},viewMachine.prototype.splice=function(e,i,t){var n;if(t){t.parent=this,n=this.children.splice(e,i,t);try{if(this.drawn&&void 0!==t)if(e>0){var r=document.getElementById(this.children[e-1].properties.id);r?r.insertAdjacentHTML("afterend",t.html(!0).outerHTML):this.append(t),t.drawn=!0}else document.getElementById(this.properties.id).appendChild(t.html(!0)),t.drawn=!0}catch(a){this.parent.draw()}}else n=this.children.splice(e,i);if(this.drawn)for(var s=n.length,h=0;s>h;h++)n[h].remove();return this},viewMachine.prototype.text=function(e){return this.properties.text=e,this},viewMachine.events={},viewMachine.addEventListener=function(e,i,t){e.addEventListener?e.addEventListener(i,t):e.attachEvent("on"+i,t)},viewMachine.on=function(e,i,t){if("string"!=typeof e||"function"!=typeof i)throw"Type Error: viewMachine.on expects, (string, function)";void 0===viewMachine.event[e]&&(viewMachine.event[e]=[]),viewMachine.event[e].push([i,t])},viewMachine.trigger=function(e,i){if(void 0!==viewMachine.event[e])for(var t={event:e,timestamp:(new Date).getTime()},n=0;viewMachine.event[e].length>n;n++)2===viewMachine.event[e][n].length&&(t.data=viewMachine.event[e][n][1]),viewMachine.event[e][n][0](t,i)},viewMachine.removeAllListeners=function(e){void 0!==viewMachine.event[e]&&delete viewMachine.event[e]},viewMachine.prototype.event=function(e,i){if(this.events.push({event:e,callback:i}),"function"==typeof i)this.drawn&&viewMachine.addEventListener(document.getElementById(this.properties.id),e,function(e){e.data=this,i(e)});else if("string"==typeof i&&this.drawn){var t=this;viewMachine.addEventListener(document.getElementById(this.properties.id),e,function(){viewMachine.trigger(i,t)})}return this},viewMachine.crunch=function(e){for(var i=viewMachine(e),t=i.children(),n=t.length,r=0;n>r;r++)viewMachine.crunch(t[r]);return i},viewMachine.extend=function(e){e=e||{};for(var i=1;arguments.length>i;i++){var t=arguments[i];if(t){if(Array.isArray(t)){e=[];for(var n=0;t.length>n;n++)"object"==typeof t[n]?(e.push({}),viewMachine.extend(e[i],t[i])):e.push(t[i])}for(var r in t)t.hasOwnProperty(r)&&("object"==typeof t[r]?viewMachine.extend(e[r],t[r]):e[r]=t[r])}}return e};var h=Object.prototype.hasOwnProperty;viewMachine.isEmpty=function(e){if(null===e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var i in e)if(h.call(e,i))return!1;return!0},viewMachine.schonfinkelize=function(e){var i=Array.prototype.slice,t=i.call(arguments,1);return function(){var n=i.call(arguments),r=t.concat(n);return e.apply(null,r)}},viewMachine.parent=function(e,i,t){var n,r,a=e;if(e.properties&&(r=e.properties,a=e.type),n=new viewMachine.init(a,r),"number"==typeof t)for(var s=0;t>s;s++)n.append(new viewMachine.init(i));else if(Array.isArray(t))for(var h,c=t.length,o=0;c>o;o++)h="object"==typeof t[o]?"ViewMachine"===t[o].type?t[o]:new viewMachine.init(i,t[o]):new viewMachine.init(i,{text:t[o]}),n.append(h);return n},viewMachine.types=viewMachine.types||{},viewMachine.properties=viewMachine.properties||{},viewMachine.List=function(e){var i="ul",t=e;return e.parent&&(i={type:"ul",properties:e.parent},t=e.children),viewMachine.parent(i,"li",t)},viewMachine.Select=function(e){var i="select",t=e;return e.parent&&(i={type:"select",properties:e.parent},t=e.children),viewMachine.parent(i,"option",t)},viewMachine.Table=function(e,i,t){var n,r,a=viewMachine("table"),s=viewMachine("thead"),c=viewMachine("tbody"),o=i.length,p=t||i;a.currentHeadings=p,s.append(new viewMachine.parent("tr","th",p));for(var d in e)if(h.call(e,d)){n=viewMachine("tr");for(var v=0;o>v;v++)r=e[d][i[v]],Array.isArray(r)&&(r=r.join(", ")),n.append(viewMachine("td",{text:r}));c.append(n)}return a.children.push(s),a.append(c),a.preserve=!1,a.keys=i,viewMachine.extend(a,viewMachine.types.table),a.currentData={},a.currentData=viewMachine.extend(a.currentData,e),a},viewMachine.properties.table=["currentData","keys","currentHeadings"],viewMachine.types.table={data:function(e){var i,t=this.keys.length;i=Array.isArray(e)?[]:{};var n,r,a=0,s=0;for(var c in this.currentData)void 0===e[c]?s++:(s>0&&this.children[1].splice(a,s),a++,s=0);s>0&&this.children[1].splice(a,s),a=0;for(var o in e)if(h.call(e,o)){if(i[o]=e[o],h.call(this.currentData,o)){if(JSON.stringify(this.currentData[o])!==JSON.stringify(e[o]))for(var p=0;t>p;p++)h.call(e[o],this.keys[p])&&e[o][this.keys[p]]!==this.currentData[o][this.keys[p]]&&this.cell(a,p).text(e[o][this.keys[p]])}else{n=viewMachine("tr");for(var d=0;t>d;d++)h.call(e[o],this.keys[d])?(r=e[o][this.keys[d]],Array.isArray(r)&&(r=r.join(", ")),n.append(viewMachine("td",{text:r}))):n.append(viewMachine("td"));this.children[1].splice(a,0,n)}a++}return this.currentData=i,this},headings:function(e,i){this.currentHeadings=i||e;var t={};return t=viewMachine.extend(t,this.currentData),this.children[0].splice(0,1,new viewMachine.parent("tr","th",this.currentHeadings)),this.data([]),this.keys=e,this.data(t),this},cell:function(e,i){return this.children[1].children[e].children[i]}},viewMachine.Video=function(e,i,t){var n=viewMachine("video",t);for(var r in e)n.append(viewMachine("source",{src:i+"."+e[r],type:"video/"+e[r]}));return n},viewMachine.Image=function(e,i,t){var n=viewMachine("img",{src:i,"data-img":e});n.preload=i,n.src=e;for(var r in t)n.properties[r]=t[r];var a=new Image;return a.onload=function(){n.properties.src=n.properties["data-img"],n.drawn&&n.draw()},a.src=e,n},viewMachine.properties.img=["src","preload"],Template.prototype.ref=function(e,i){this.refs=this.refs||{},this.refs[e]=i},Template.prototype.dataHandler=function(e,i,t){this.data=this.data||{},this.data[e]=viewMachine.schonfinkelize(t,i)},viewMachine.Gen=function(e){this.build=function(){return new Template(e)}};