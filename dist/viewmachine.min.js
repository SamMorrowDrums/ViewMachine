/*! viewmachine 07-08-2014 */
viewMachine=function(e,i,t){return new viewMachine.init(e,i,t)},function(){for(var e,i,t=3,n=document.createElement("div"),r=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",r[0];);i=t>4?t:e,viewMachine.old=i&&9>i?!0:null}(),viewMachine.init=function(e,i,t){var n;if(null===e)throw"Value Error: element must be either an HTMLElement, or a string of an HTMLElement";if(1===e.nodeType){if(n=e,void 0!==n.VM)return n.VM.attrs(i),n.VM.css(t),n.VM}else{if("string"!=typeof e){if(e instanceof viewMachine.init==!0)return e.attrs(i),e.css(t),e;throw"Value Error: element must be either an HTMLElement, or a string of an HTMLElement"}n="body"!==e.toLowerCase()?document.createElement(e):document.body}return this.$=n,viewMachine.old||(n.VM=this),this.element=n.tagName,this.attrs(i),this.css(t),this},null===window.onload?window.onload=function(){viewMachine.body=viewMachine(document.body)}:null===document.onload&&(document.onload=function(){viewMachine.body=viewMachine(document.body)}),viewMachine.init.prototype=viewMachine.prototype,window.viewMachine=window.VM=viewMachine,viewMachine.extend=function(e){e=e||{};for(var i=1;arguments.length>i;i++){var t=arguments[i];if(t){if(Array.isArray(t)){e=[];for(var n=0;t.length>n;n++)"object"==typeof t[n]?(e.push({}),viewMachine.extend(e[i],t[i])):e.push(t[i])}for(var r in t)t.hasOwnProperty(r)&&("object"==typeof t[r]?viewMachine.extend(e[r],t[r]):e[r]=t[r])}}return e};var h=Object.prototype.hasOwnProperty;viewMachine.isEmpty=function(e){if(null===e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var i in e)if(h.call(e,i))return!1;return!0},viewMachine.schonfinkelize=function(e){var i=Array.prototype.slice,t=i.call(arguments,1);return function(){var n=i.call(arguments),r=t.concat(n);return e.apply(null,r)}},viewMachine.prototype.attrs=function(e,i){if("object"==typeof e)for(var t in e)"text"===t||"HTMLtext"===t?this[t](e[t]):"style"===this[t]?this.css(t,e[t]):this.$.setAttribute(t,e[t]);else if("string"==typeof e&&void 0!==i)this.$.setAttribute(e,i);else if(void 0!==e)return this.$.getAttribute(e);return this},viewMachine.prototype.getAllAttrs=function(){for(var e=this.$.attributes,i={},t=0;e.length>t;t++)i[e[t].name]=e[t].value;return i},viewMachine.prototype.data=function(e,i){var t="data-";if("object"==typeof e)for(var n in e)this.$.setAttribute(t+(""+n),e[n]);else if("string"==typeof e&&void 0!==i)this.$.setAttribute(t+(""+e),i);else if(void 0!==e)return this.$.getAttribute(t+(""+e));return this},viewMachine.prototype.css=function(e,i){if("object"==typeof e)for(var t in e)this.$.style[t]=e[t];else if("string"==typeof e&&void 0!==i)this.$.style[e]=i;else if(void 0!==e){var n=getComputedStyle(this.$)[e];return n||(n=this.$.style[e]),n}return this},viewMachine.prototype.addClass=function(e){var i,t=this.$.getAttribute("class")||"";return 0>t.indexOf(e)&&(i=t.split(" "),i.push(e),this.$.setAttribute("class",i.join(" "))),this},viewMachine.prototype.removeClass=function(e){var i,t,n=this.$.getAttribute("class");return n&&(i=n.split(" "),t=i.indexOf(e),t>=0&&(i.splice(t,1),this.$.setAttribute("class",i.join(" ")))),this},viewMachine.prototype.parent=function(){var e=this.$.parentNode;if(e=e&&1===e.nodeType?e:null,e&&void 0!==e.VM)return e.VM;if(e)return VM(e);throw"Parent is undefined or null"},viewMachine.prototype.children=function(){for(var e=this.$.children||[],i=[],t=0;e.length>t;t++)void 0!==e[t].VM?i.push(e[t].VM):i.push(viewMachine(e[t]));return i},viewMachine.prototype.remove=function(){return this.parent()&&this.parent().$.removeChild(this.$),this},viewMachine.prototype.empty=function(){return this.$.innerHTML="",this.innerText=null,this},viewMachine.prototype.replace=function(e){var i=this.parent();return i&&viewMachine(i).$.replaceChild(viewMachine(e).$,this.$),this},viewMachine.prototype.append=function(e){return this.$.appendChild(viewMachine(e).$),this},viewMachine.prototype.mappend=function(e){for(var i=0;e.length>i;i++)e[i]&&this.append(e[i]);return this},viewMachine.prototype.prepend=function(e){var i=e.$?e:viewMachine(e),t=this.children();return this.empty(),this.append(i),this.mappend(t),this},viewMachine.prototype.splice=function(e,i,t){var n=t?viewMachine(t):null,r=this.children(),a=n?r.splice(e,i,n):r.splice(e,i);return a=a||[],this.empty(),this.mappend(r),a},viewMachine.prototype.text=function(e){return this.$.innerHTML=viewMachine.escape(e),this.innerText=!0,this},viewMachine.escape=function(e){var i=document.createElement("div");return i.appendChild(document.createTextNode(e)),i.innerHTML},viewMachine.prototype.HTMLtext=function(e){var i,t=[],n=/<([^>]+)>/gm,r=/<\w+(?=\s)[^>]*?\s(on\w+)[\s\S]+?>/gm,a=e.match(n);if(a)for(var s=0;a.length>s;s++)i=e.substring(0,e.indexOf(a[s])),t.push(viewMachine.escape(i)),0>a[s].toLowerCase().indexOf("script")&&null===a[s].match(r)&&t.push(a[s]),e=e.substring(e.indexOf(a[s])+a[s].length);return t.push(viewMachine.escape(e)),this.$.innerHTML=t.join(""),this.innerText=!0,this},viewMachine.trim=function(e,i,t){return e.length>=i&&(e=e.substring(0,i)),t?e+t:e},viewMachine.events={},viewMachine.addEventListener=function(e,i,t){e.addEventListener?e.addEventListener(i,t):e.attachEvent("on"+i,t)},viewMachine.on=function(e,i,t){if("string"!=typeof e||"function"!=typeof i)throw"Type Error: viewMachine.on expects, (string, function)";void 0===viewMachine.event[e]&&(viewMachine.event[e]=[]),viewMachine.event[e].push([i,t])},viewMachine.trigger=function(e,i){if(void 0!==viewMachine.event[e])for(var t={event:e,timestamp:(new Date).getTime()},n=0;viewMachine.event[e].length>n;n++)2===viewMachine.event[e][n].length&&(t.data=viewMachine.event[e][n][1]),viewMachine.event[e][n][0](t,i)},viewMachine.removeAllListeners=function(e){void 0!==viewMachine.event[e]&&delete viewMachine.event[e]},viewMachine.prototype.event=function(e,i){if(this.events.push({event:e,callback:i}),"function"==typeof i)this.drawn&&viewMachine.addEventListener(document.getElementById(this.properties.id),e,function(e){e.data=this,i(e)});else if("string"==typeof i&&this.drawn){var t=this;viewMachine.addEventListener(document.getElementById(this.properties.id),e,function(){viewMachine.trigger(i,t)})}return this},viewMachine.parent=function(e,i,t){var n="object"==typeof e&&e.type?VM(e.type,e.attrs):VM(e);if(children=[],Array.isArray(t))for(var r=0;t.length>r;r++)"object"==typeof t[r]?children.push(VM(i,t[r])):children.push(VM(i,{text:t[r]}));else if("number"==typeof t)for(var a=0;t>a;a++)children.push(VM(i));return n.mappend(children)},viewMachine.types=viewMachine.types||{},viewMachine.properties=viewMachine.properties||{},viewMachine.List=function(e){var i,t="ul",n=e;return e.attrs&&(t={type:"ul",attrs:e.attrs},n=e.values),i=viewMachine.parent(t,"li",n),viewMachine.extend(i,viewMachine.types.list),i},viewMachine.types.list={values:function(e){var i=viewMachine.parent("ul","li",e);this.empty(),this.mappend(i.children())}},viewMachine.Select=function(e){var i="select",t=e;e.parent&&(i={type:"select",attrs:e.parent},t=e.children);var n=viewMachine.parent(i,"option",t);return viewMachine.extend(n,viewMachine.types.select),n},viewMachine.types.select={options:function(e){var i=viewMachine.parent("select","option",e);this.empty(),this.mappend(i.children())}},viewMachine.Table=function(e,i,t){var n,r,a=viewMachine("table"),s=viewMachine("thead"),c=viewMachine("tbody"),h=i.length,o=t||i;a.currentHeadings=o,s.append(viewMachine.parent("tr","th",o)),a.append(s);for(var v in e)if(e.hasOwnProperty(v)){n=viewMachine("tr");for(var p=0;h>p;p++)r=e[v][i[p]],void 0===r&&(r=""),Array.isArray(r)&&(r=r.join(", ")),n.append(viewMachine("td",{text:r}));c.append(n)}return a.append(c),a.preserve=!1,a.keys=i,viewMachine.extend(a,viewMachine.types.table),a.currentData={},a.currentData=viewMachine.extend(a.currentData,e),a},viewMachine.properties.table=["currentData","keys","currentHeadings"],viewMachine.types.table={data:function(e){var i,t=this.keys.length;i=Array.isArray(e)?[]:{};var n,r,a=0,s=0;for(var c in this.currentData)void 0===e[c]?s++:(s>0&&this.children[1].splice(a,s),a++,s=0);s>0&&this.children[1].splice(a,s),a=0;for(var h in e)if(e.hasOwnProperty(h)){if(i[h]=e[h],this.currentData.hasOwnProperty(h)){if(JSON.stringify(this.currentData[h])!==JSON.stringify(e[h]))for(var o=0;t>o;o++)e[h].hasOwnProperty(this.keys[o])&&e[h][this.keys[o]]!==this.currentData[h][this.keys[o]]&&this.cell(a,o).text(e[h][this.keys[o]])}else{n=viewMachine("tr");for(var v=0;t>v;v++)e[h].hasOwnProperty(this.keys[v])?(r=e[h][this.keys[v]],Array.isArray(r)&&(r=r.join(", ")),n.append(viewMachine("td",{text:r}))):n.append(viewMachine("td"));this.children[1].splice(a,0,n)}a++}return this.currentData=i,this},headings:function(e,i){this.currentHeadings=i||e;var t={};return t=viewMachine.extend(t,this.currentData),this.children()[0].splice(0,1,new viewMachine.parent("tr","th",this.currentHeadings)),this.data([]),this.keys=e,this.data(t),this},cell:function(e,i){return this.children()[1].children()[e].children()[i]}},viewMachine.Video=function(e,i,t){var n=viewMachine("video",t);for(var r in e)n.append(viewMachine("source",{src:i+"."+e[r],type:"video/"+e[r]}));return n},viewMachine.Image=function(e,i,t){var n=viewMachine("img",viewMachine.extend(t,{src:i,"data-img":e}));n.preload=i,n.src=e;var r=new Image;return r.onload=function(){n.attrs("src",n.data("img"))},r.src=e,n},viewMachine.properties.img=["src","preload"],viewMachine.createTemplate=function(e){var i={},t=e.element.toLowerCase();if("object"==typeof e&&e instanceof viewMachine.init){if(i.element=e.element,void 0!==e.id&&(i.id=e.id),i.attrs=e.getAllAttrs()||{},e.innerText)i.attrs.text=e.$.innerHTML;else{var n=e.children();if(!n.length||void 0!==e.preserve&&e.preserve!==!0)e.preserve===!1&&(i.preserve=!1);else{i.children=[];for(var r in n)"object"==typeof e&&e instanceof viewMachine.init&&i.children.push(viewMachine.createTemplate(n[r]))}if(viewMachine.properties[t])for(var a in viewMachine.properties[t])"object"==typeof e[viewMachine.properties[t][a]]?(i[viewMachine.properties[t][a]]=Array.isArray(e[viewMachine.properties[t][a]])?[]:{},i[viewMachine.properties[t][a]]=viewMachine.extend(i[viewMachine.properties[t][a]],e[viewMachine.properties[t][a]])):i[viewMachine.properties[t][a]]=e[viewMachine.properties[t][a]]}if(e.events&&e.events.length){i.events=[];for(var s in e.events)"string"==typeof e.events[s].callback&&i.events.push({event:e.events[s].event,callback:e.events[s].callback})}return i}return!1},viewMachine.construct=function(e){var i,t=e.element.toLowerCase();if(e.preserve===!1){for(var n={func:t.substring(0,1).toUpperCase()+t.substring(1),info:[]},r=0;viewMachine.properties[t].length>r;r++)n.info.push(e[viewMachine.properties[t][r]]);i=viewMachine[n.func].apply(viewMachine,n.info),i.attrs(e.attrs)}else{if(i="img"===t&&"string"==typeof e.preload?viewMachine.Image(e.src,e.preload,e.attrs):new viewMachine.init(t,e.attrs),viewMachine.properties[i.element])for(var a in viewMachine.properties[i.element])"object"==typeof i[viewMachine.properties[i.element][a]]?(i[viewMachine.properties[i.element][a]]={},viewMachine.extend(i[viewMachine.properties[i.element][a]],e[viewMachine.properties[i.element][a]])):i[viewMachine.properties[i.element][a]]=e[viewMachine.properties[i.element][a]];viewMachine.types[i.element]&&viewMachine.extend(i,viewMachine.types[i.element])}for(var s in e.children)i.append(viewMachine.construct(e.children[s]));return void 0!==e.events,i},viewMachine.jsonTemplate=function(e){if("string"==typeof e){var i=JSON.parse(e);return viewMachine.construct(i)}return"object"==typeof e&&(e=viewMachine.createTemplate(e)),JSON.stringify(e)},viewMachine.crunch=function(e){for(var i=viewMachine(e),t=i.children(),n=t.length,r=0;n>r;r++)viewMachine.crunch(t[r]);return i},viewMachine.crunchMap=function(e){var i,t,n,r,a;i=2===arguments.length?arguments[1]:{origin:viewMachine.crunch(e),id:{},classes:{},name:{}},t=e.VM?e.children:e.$.children;for(var s=0;t.length>s;s++){if(r=t[s].id,r&&(i.id[r]=t[s].VM),n=t[s].getAttribute("class")){n=n.split(" ");for(var c=0;n.length>c;c++)i.classes[n[c]]=i.classes[n[c]]||[],i.classes[n[c]].push(t[s].VM)}a=t[s].getAttribute("name"),a&&(i.name[a]=t[s].VM),viewMachine.crunchMap(t[s],i)}return i},function(e){function i(){var i=e.jsonTemplate(this.template),t=e.crunchMap(i);return this.fn&&this.fn.apply(t,arguments),t}e.gen=function(e,t){return i.bind({template:e,fn:t})}}(viewMachine);