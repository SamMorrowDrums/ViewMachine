/*! viewmachine 26-02-2014 */
if(void 0===ViewMachine)var ViewMachine={};if(ViewMachine=function(e){"use strict";e.extend=function(t){t=t||{};for(var r=1;arguments.length>r;r++){var i=arguments[r];if(i){if(Array.isArray(i)){t=[];for(var n=0;i.length>n;n++)"object"==typeof i[n]?(t.push({}),e.extend(t[r],i[r])):t.push(i[r])}for(var s in i)i.hasOwnProperty(s)&&("object"==typeof i[s]?e.extend(t[s],i[s]):t[s]=i[s])}}return t},e.event={},e.addEventListener=function(e,t,r){e.addEventListener?e.addEventListener(t,r):e.attachEvent("on"+t,r)},e.on=function(t,r,i){if("string"!=typeof t||"function"!=typeof r)throw"Type Error: VM.on expects, (string, function)";void 0===e.event[t]&&(e.event[t]=[]),e.event[t].push([r,i])},e.trigger=function(t,r){if(void 0!==e.event[t])for(var i={event:t,timestamp:(new Date).getTime()},n=0;e.event[t].length>n;n++)2===e.event[t][n].length&&(i.data=e.event[t][n][1]),e.event[t][n][0](i,r)},e.removeAllListeners=function(t){void 0!==e.event[t]&&delete e.event[t]};var t=Object.prototype.hasOwnProperty;return e.isEmpty=function(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var r in e)if(t.call(e,r))return!1;return!0},e}(ViewMachine),void 0===ViewMachine)var ViewMachine={};ViewMachine=function(e){"use strict";var t;return t=function(r,i){var n,s,a,p,o,l;if("[object Array]"===Object.prototype.toString.call(r))for(n=0;r.length>n;n+=1)i.append(t(r[n],i));else if("string"==typeof r)e.makeElement(r);else for(s in r)if(r.hasOwnProperty(s)){switch(-1!==s.indexOf(":")&&(a=s.split(":")),p=void 0!==a?a[0]:s){case"div":o=e.makeElement(void 0!==a?a[0]:s,void 0!==a?a[1]:""),o.append(t(r[s],o));break;case"form":o=e.makeForm(r[s]);break;case"list":o=e.makeList(r[s]);break;case"table":o=e.makeTable(r[s].keyList,r[s].data);break;case"b":case"p":o=e.makeElement(void 0!==a?a[0]:s,void 0!==a?a[1]:""),"[object Array]"!==Object.prototype.toString.call(r[s])&&o.append(r[s]);break;case"img":o=["<img "+(void 0!==a?'class="'+a[1]+'" ':"")+'src="'+r[s]+'" '+(void 0!==a?'title="'+a[1]+'" ':"")+'alt="'+(void 0!==a?a[1]:r[s])+'" />'];break;case"h1":case"h2":case"h3":case"h4":o=e.makeElement(void 0!==a?a[0]:s,void 0!==a?a[1]:""),o.append(e.cleanTitles(r[s]));break;default:o=e.makeElement(void 0!==a?a[0]:s,void 0!==a?a[1]:""),o.append(l)}void 0!==o&&i.append(o)}return i},e.build=function(r){var i,n;return i=r.name,n=e.makeElement("div",i+" view"),n=t(r.structure,n)},e.example={name:"example",structure:[{h1:"The Title"},{div:{div:{p:'This is an <a href="#">example<a/> of paragraph text<br>squirted into a document with <b>inner HTML</b> '},form:e.exampleForm}},{"div:myClass":[{h3:"Sub-title"},{"p:green":"This is a list of paragraphs"}]}]},e}(ViewMachine);var VM=ViewMachine;if(ViewMachine=function(e,t){"use strict";var r=[];return e.El=function(e,t){return this.element=e,void 0===t&&(t={}),t.id&&(this.id=t.id),this.drawn=!1,this.properties=t,this.children=[],this.events=[],this.style={},this},e.El.prototype={text:function(e){return this.properties.text=e,this.drawn&&this.draw(),this},getId:function(){return this.id?this.id:""+Math.floor(1e7*Math.random()+1)},html:function(e){this.drawn||(this.properties.id=this.getId()),e&&(this.drawn=!0);var i=t.createElement(this.element);for(var n in this.properties)"text"===n?i.innerHTML=this.properties[n]:"id"===n?i.id=this.properties[n]:i.setAttribute(n,this.properties[n]);for(var s in this.style)i.style[s]=this.style[s];for(var a=this.children.length,p=0;a>p;p++)i.appendChild(this.children[p].html(e));for(var o in this.events)this.events[o].id=this.properties.id,r.push([this.events[o],this]);return i},$:function(){return this.drawn?t.getElementById(this.properties.id):this.html()},draw:function(){function i(r,i,n,s){e.addEventListener(t.getElementById(r),i,function(){e.trigger(n,s)})}if(r=[],this.drawn)this.replace(this.html(!0).outerHTML);else{var n;if("string"==typeof this.parent)n=t.getElementsByTagName(this.parent)[0],n.appendChild(this.html(!0)),this.drawn=!0;else{if(this.parent.drawn!==!0)throw"DrawError: Parent element not on page";n=t.getElementById(this.parent.properties.id),n.appendChild(this.html(!0)),this.drawn=!0}}for(var s=r.length,a=0;s>a;a++)"function"==typeof r[a][0].callback?e.addEventListener(t.getElementById(r[a][0].id),r[a][0].event,r[a][0].callback):i(r[a][0].id,r[a][0].event,r[a][0].callback,r[a][1]);return this},event:function(r,i){if(this.events.push({event:r,callback:i}),"function"==typeof i)this.drawn&&e.addEventListener(t.getElementById(this.properties.id),r,function(e){e.data=this,i(e)});else if("string"==typeof i&&this.drawn){var n=this;e.addEventListener(t.getElementById(this.properties.id),r,function(){e.trigger(i,n)})}return this},remove:function(){if(this.drawn){var e=t.getElementById(this.properties.id);e&&e.parentNode.removeChild(e),this.drawn=!1}if("string"!=typeof this.parent)for(var r=this.parent.children,i=r.length,n=0;i>n;n++)r[n].properties.id===this.properties.id&&this.parent.children.splice(n,1);return this},replace:function(e){return this.drawn?(t.getElementById(this.properties.id).outerHTML=e,this):void 0},hide:function(){if(this.drawn){var e=t.getElementById(this.properties.id);e.parentNode.removeChild(e),this.drawn=!1}return this},append:function(e){return e.parent=this,this.children.push(e),this.drawn&&e.draw(),this},prepend:function(e){return e.parent=this,this.children=[e].concat(this.children),this.drawn&&this.draw(),this},splice:function(e,r,i){var n;if(i){if(i.parent=this,n=this.children.splice(e,r,i),this.drawn&&void 0!==i)if(e>0){var s=t.getElementById(this.children[e-1].properties.id);s?s.insertAdjacentHTML("afterend",i.html(!0).outerHTML):this.append(i),i.drawn=!0}else t.getElementById(this.properties.id).appendChild(i.html(!0)),i.drawn=!0}else n=this.children.splice(e,r);if(this.drawn)for(var a=n.length,p=0;a>p;p++)n[p].remove();return this},addClass:function(e){var r;return r=this.properties["class"]?this.properties["class"].split(" "):[],-1===r.indexOf(e)&&(r.push(e),this.properties["class"]=r.join(" "),this.drawn&&t.getElementById(this.properties.id).setAttribute("class",this.properties["class"])),this},removeClass:function(e){var r=this.properties["class"].split(" "),i=r.indexOf(e);return i>=0&&(r.splice(i,1),this.properties["class"]=r.join(" "),this.drawn&&t.getElementById(this.properties.id).setAttribute("class",this.properties["class"])),this},css:function(e,r){if("string"==typeof e){if(void 0===r)return this.drawn?getComputedStyle(t.getElementById(this.properties.id))[e]:this.style[e]||"";this.style[e]=r,this.drawn&&(t.getElementById(this.properties.id).style[e]=r)}else for(var i in e)this.style[i]=e[i],this.drawn&&(t.getElementById(this.properties.id).style[i]=e[i]);return this},parent:"body",type:"ViewMachine"},e.ParentEl=function(t,r,i){var n,s,a=t;if(t.properties&&(s=t.properties,a=t.type),n=new e.El(a,s),"number"==typeof i)for(var p=0;i>p;p++)n.append(new e.El(r));else if(Array.isArray(i))for(var o,l=i.length,h=0;l>h;h++)o="object"==typeof i[h]?"ViewMachine"===i[h].type?i[h]:new e.El(r,i[h]):new e.El(r,{text:i[h]}),n.append(o);return n},e.createTemplate=function(t){var r={};if("object"==typeof t&&"ViewMachine"===t.type){if(r.element=t.element,e.isEmpty(t.style)||(r.style=t.style),void 0!==t.id&&(r.id=t.id),!e.isEmpty(t.properties))for(var i in t.properties)void 0!==t.properties[i]&&"id"!==i&&(r.properties=r.properties||{},r.properties[i]=t.properties[i]);if(!t.children.length||void 0!==t.preserve&&t.preserve!==!0)t.preserve===!1&&(r.preserve=!1);else{r.children=[];for(var n in t.children)"object"==typeof t&&"ViewMachine"===t.type&&r.children.push(e.createTemplate(t.children[n]))}if(e.properties[t.element])for(var s in e.properties[t.element])"object"==typeof t[e.properties[t.element][s]]?(r[e.properties[t.element][s]]=Array.isArray(t[e.properties[t.element][s]])?[]:{},r[e.properties[t.element][s]]=e.extend(r[e.properties[t.element][s]],t[e.properties[t.element][s]])):r[e.properties[t.element][s]]=t[e.properties[t.element][s]];if(t.events.length){r.events=[];for(var a in t.events)"string"==typeof t.events[a].callback&&r.events.push({event:t.events[a].event,callback:t.events[a].callback})}return r}return!1},e.construct=function(t){var r;if(t.preserve===!1)r=new(e[t.element.substring(0,1).toUpperCase()+t.element.substring(1,t.element.length)])(t[e.properties[t.element][0]],t[e.properties[t.element][1]],t[e.properties[t.element][2]],t[e.types[t.element][3]]);else{if(r="img"===t.element&&"string"==typeof t.preload?new e.Image(t.src,t.preload,t.properties):new e.El(t.element,t.properties),e.properties[r.element])for(var i in e.properties[r.element])"object"==typeof r[e.properties[r.element][i]]?(r[e.properties[r.element][i]]={},e.extend(r[e.properties[r.element][i]],t[e.properties[r.element][i]])):r[e.properties[r.element][i]]=t[e.properties[r.element][i]];e.types[r.element]&&e.extend(r,e.types[r.element])}for(var n in t.children)r.append(e.construct(t.children[n]));return t.style&&(r.style=t.style),void 0!==t.id&&(r.id=t.id),void 0!==t.events&&(r.events=t.events),r},e.jsonTemplate=function(t){if("string"==typeof t){var r=JSON.parse(t);return e.construct(r)}return"object"==typeof t&&"ViewMachine"===t.type&&(t=e.createTemplate(t)),JSON.stringify(t)},e}(ViewMachine,document),void 0===ViewMachine)var ViewMachine={};ViewMachine=function(e,t){"use strict";return e.types=e.types||{},e.properties=e.properties||{},e.List=function(t){var r="ul",i=t;return t.parent&&(r={type:"ul",properties:t.parent},i=t.children),e.ParentEl(r,"li",i)},e.Select=function(t){var r="select",i=t;return t.parent&&(r={type:"select",properties:t.parent},i=t.children),e.ParentEl(r,"option",i)},e.Table=function(r,i,n){var s,a,p=new e.El("table"),o=new e.El("thead"),l=new e.El("tbody"),h=i.length,d=n||i;p.currentHeadings=d,o.append(new e.ParentEl("tr","th",d));for(var c in r)if(t.call(r,c)){s=new e.El("tr");for(var f=0;h>f;f++)a=r[c][i[f]],Array.isArray(a)&&(a=a.join(", ")),s.append(new e.El("td",{text:a}));l.append(s)}return p.children.push(o),p.append(l),p.preserve=!1,p.keys=i,e.extend(p,e.types.table),p.currentData={},p.currentData=e.extend(p.currentData,r),p},e.properties.table=["currentData","keys","currentHeadings"],e.types.table={data:function(r){var i,n=this.keys.length;i=Array.isArray(r)?[]:{};var s,a,p=0,o=0;for(var l in this.currentData)void 0===r[l]?o++:(o>0&&this.children[1].splice(p,o),p++,o=0);o>0&&this.children[1].splice(p,o),p=0;for(var h in r)if(t.call(r,h)){if(i[h]=r[h],t.call(this.currentData,h)){if(JSON.stringify(this.currentData[h])!==JSON.stringify(r[h]))for(var d=0;n>d;d++)t.call(r[h],keys[d])&&r[h][keys[d]]!==this.currentData[h][this.keys[d]]&&this.cell(p,d).text(r[h][this.keys[d]])}else{s=new e.El("tr");for(var c=0;n>c;c++)t.call(r[h],this.keys[c])?(a=r[h][this.keys[c]],Array.isArray(a)&&(a=a.join(", ")),s.append(new e.El("td",{text:a}))):s.append(new e.El("td"));this.children[1].splice(p,0,s)}p++}return this.currentData=i,this},headings:function(t,r){this.currentHeadings=r||t;var i={};return i=e.extend(i,this.currentData),this.children[0].splice(0,1,new e.ParentEl("tr","th",this.currentHeadings)),this.data([]),this.keys=t,this.data(i),this},cell:function(e,t){return this.children[1].children[e].children[t]}},e.Video=function(t,r,i){var n=new e.El("video",i);for(var s in t)n.append(new e.El("source",{src:r+"."+t[s],type:"video/"+t[s]}));return n},e.Image=function(t,r,i){var n=new e.El("img",{src:r,"data-img":t});n.preload=r,n.src=t;for(var s in i)n.properties[s]=i[s];var a=new Image;return a.onload=function(){n.properties.src=n.properties["data-img"],n.drawn&&n.draw()},a.src=t,n},e.properties.img=["src","preload"],e}(ViewMachine,Object.prototype.hasOwnProperty);