/*! viewmachine 20-05-2014 */
function Template(e){this.DOM=e.apply(this)}viewMachine=function(e,t,i){return new viewMachine.init(e,t,i)},viewMachine.init=function(e,t,i){var n;if(e instanceof HTMLElement==!0){if(n=e,void 0!==n.VM)return n.VM.attrs(t),n.VM.css(i),n.VM}else{if("string"!=typeof e){if(e instanceof viewMachine.init==!0)return e.attrs(t),e.css(i),e;throw"Value Error: element must be either an HTMLElement, or a string of an HTMLElement"}n="body"!==e.toLowerCase()?document.createElement(e):document.body}return this.$=n,n.VM=this,this.element=n.tagName,this.attrs(t),this.css(i),this},null===window.onload?window.onload=function(){viewMachine.body=viewMachine(document.body)}:null===document.onload&&(document.onload=function(){viewMachine.body=viewMachine(document.body)}),viewMachine.init.prototype=viewMachine.prototype,window.viewMachine=window.VM=viewMachine,viewMachine.prototype.attrs=function(e,t){if("object"==typeof e)for(var i in e)("text"===i||"HTMLtext"===i)&&this[i](e[i]),this.$.setAttribute(i,e[i]);else if("string"==typeof e&&void 0!==t)this.$.setAttribute(e,t);else if(void 0!==e)return this.$.getAttribute(e);return this},viewMachine.prototype.getAllAttrs=function(){for(var e=this.$.attributes,t={},i=0;e.length>i;i++)t[e[i].name]=e[i].value;return t},viewMachine.prototype.data=function(e,t){var i="data-";if("object"==typeof e)for(var n in e)this.$.setAttribute(i+(""+n),e[n]);else if("string"==typeof e&&void 0!==t)this.$.setAttribute(i+(""+e),t);else if(void 0!==e)return this.$.getAttribute(i+(""+e));return this},viewMachine.prototype.css=function(e,t){if("object"==typeof e)for(var i in e)this.$.style[i]=e[i];else if("string"==typeof e&&void 0!==t)this.$.style[e]=t;else if(void 0!==e)return getComputedStyle(this.$)[e];return this},viewMachine.prototype.addClass=function(e){var t,i=this.$.getAttribute("class");return i&&0>i.indexOf(e)?(t=i.split(" "),t.push(e),this.$.setAttribute("class",t.join(" "))):this.$.setAttribute("class",e),this},viewMachine.prototype.removeClass=function(e){var t,i,n=this.$.getAttribute("class");return n&&(t=n.split(" "),i=t.indexOf(e),i>=0&&(t.splice(i,1),this.$.setAttribute("class",t.join(" ")))),this},viewMachine.prototype.parent=function(){var e=this.$.parentNode;return e&&void 0!==e.VM?e.VM:e?VM(e):e},viewMachine.prototype.children=function(){for(var e=this.$.children||[],t=[],i=0;e.length>i;i++)void 0!==e[i].VM?t.push(e[i].VM):t.push(viewMachine(e[i]));return t},viewMachine.prototype.remove=function(){return this.$.remove(),this},viewMachine.prototype.empty=function(){return this.$.innerHTML="",this},viewMachine.prototype.replace=function(e){var t=this.parent();return console.log(t),t&&viewMachine(t).$.replaceChild(viewMachine(e).$,this.$),this},viewMachine.prototype.append=function(e){return this.$.appendChild(viewMachine(e).$),this},viewMachine.prototype.mappend=function(e){for(var t=0;e.length>t;t++)this.append(e[t]);return this},viewMachine.prototype.prepend=function(e){var t=viewMachine(e);return this.$.insertAdjacentHTML("afterbegin",t.$.outerHTML),t.remove(),t.$=this.$.firstChild,this},viewMachine.prototype.splice=function(e,t,i){var n=i?viewMachine(i).remove():null,r=this.children(),a=r.splice(e,t)||[];i&&(a.length?(a[a.length-1].$.insertAdjacentHTML("afterend",n.$.outerHTML),viewMachine(a[a.length-1].$.nextSibling)):t>0||this.prepend(i));for(var h=0;a.length>h;h++)a[h].remove();return a},viewMachine.prototype.text=function(e){return this.$.innerHTML=viewMachine.escape(e),this},viewMachine.escape=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},viewMachine.prototype.HTMLtext=function(e){var t,i=[],n=/<([^>]+)>/gm,r=/<\w+(?=\s)[^>]*?\s(on\w+)[\s\S]+?>/gm,a=e.match(n);if(a)for(var h=0;a.length>h;h++)t=e.substring(0,e.indexOf(a[h])),i.push(viewMachine.escape(t)),0>a[h].toLowerCase().indexOf("script")&&null===a[h].match(r)&&i.push(a[h]),e=e.substring(e.indexOf(a[h])+a[h].length);return i.push(viewMachine.escape(e)),this.$.innerHTML=i.join(""),this},viewMachine.trim=function(e,t,i){return e.length>=t&&(e=e.substring(0,t)),i?e+i:e},viewMachine.events={},viewMachine.addEventListener=function(e,t,i){e.addEventListener?e.addEventListener(t,i):e.attachEvent("on"+t,i)},viewMachine.on=function(e,t,i){if("string"!=typeof e||"function"!=typeof t)throw"Type Error: viewMachine.on expects, (string, function)";void 0===viewMachine.event[e]&&(viewMachine.event[e]=[]),viewMachine.event[e].push([t,i])},viewMachine.trigger=function(e,t){if(void 0!==viewMachine.event[e])for(var i={event:e,timestamp:(new Date).getTime()},n=0;viewMachine.event[e].length>n;n++)2===viewMachine.event[e][n].length&&(i.data=viewMachine.event[e][n][1]),viewMachine.event[e][n][0](i,t)},viewMachine.removeAllListeners=function(e){void 0!==viewMachine.event[e]&&delete viewMachine.event[e]},viewMachine.prototype.event=function(e,t){if(this.events.push({event:e,callback:t}),"function"==typeof t)this.drawn&&viewMachine.addEventListener(document.getElementById(this.properties.id),e,function(e){e.data=this,t(e)});else if("string"==typeof t&&this.drawn){var i=this;viewMachine.addEventListener(document.getElementById(this.properties.id),e,function(){viewMachine.trigger(t,i)})}return this},viewMachine.crunch=function(e){for(var t=viewMachine(e),i=t.children(),n=i.length,r=0;n>r;r++)viewMachine.crunch(i[r]);return t},viewMachine.extend=function(e){e=e||{};for(var t=1;arguments.length>t;t++){var i=arguments[t];if(i){if(Array.isArray(i)){e=[];for(var n=0;i.length>n;n++)"object"==typeof i[n]?(e.push({}),viewMachine.extend(e[t],i[t])):e.push(i[t])}for(var r in i)i.hasOwnProperty(r)&&("object"==typeof i[r]?viewMachine.extend(e[r],i[r]):e[r]=i[r])}}return e};var h=Object.prototype.hasOwnProperty;viewMachine.isEmpty=function(e){if(null===e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var t in e)if(h.call(e,t))return!1;return!0},viewMachine.schonfinkelize=function(e){var t=Array.prototype.slice,i=t.call(arguments,1);return function(){var n=t.call(arguments),r=i.concat(n);return e.apply(null,r)}},viewMachine.parent=function(e,t,i){var n="object"==typeof e&&e.type?VM(e.type,e.attrs):VM(e);if(children=[],Array.isArray(i))for(var r=0;i.length>r;r++)"object"==typeof i[r]?children.push(VM(t,i[r])):children.push(VM(t,{text:i[r]}));else if("number"==typeof i)for(var a=0;i>a;a++)children.push(VM(t));return n.mappend(children)},viewMachine.types=viewMachine.types||{},viewMachine.properties=viewMachine.properties||{},viewMachine.List=function(e){var t,i="ul",n=e;return e.attrs&&(i={type:"ul",attrs:e.attrs},n=e.values),t=viewMachine.parent(i,"li",n),viewMachine.extend(t,viewMachine.types.list),t},viewMachine.types.list={values:function(e){var t=viewMachine.parent("ul","li",e);this.empty(),this.mappend(t.children())}},viewMachine.Select=function(e){var t="select",i=e;e.parent&&(t={type:"select",attrs:e.parent},i=e.children);var n=viewMachine.parent(t,"option",i);return viewMachine.extend(n,viewMachine.types.select),n},viewMachine.types.select={options:function(e){var t=viewMachine.parent("select","option",e);this.empty(),this.mappend(t.children())}},viewMachine.Table=function(e,t,i){var n,r,a=viewMachine("table"),h=viewMachine("thead"),s=viewMachine("tbody"),c=t.length,o=i||t;a.currentHeadings=o,h.append(viewMachine.parent("tr","th",o)),a.append(h);for(var v in e)if(e.hasOwnProperty(v)){n=viewMachine("tr");for(var p=0;c>p;p++)r=e[v][t[p]],void 0===r&&(r=""),Array.isArray(r)&&(r=r.join(", ")),n.append(viewMachine("td",{text:r}));s.append(n)}return a.append(s),a.preserve=!1,a.keys=t,viewMachine.extend(a,viewMachine.types.table),a.currentData={},a.currentData=viewMachine.extend(a.currentData,e),a},viewMachine.properties.table=["currentData","keys","currentHeadings"],viewMachine.types.table={data:function(e){var t,i=this.keys.length;t=Array.isArray(e)?[]:{};var n,r,a=0,h=0;for(var s in this.currentData)void 0===e[s]?h++:(h>0&&this.children[1].splice(a,h),a++,h=0);h>0&&this.children[1].splice(a,h),a=0;for(var c in e)if(e.hasOwnProperty(c)){if(t[c]=e[c],this.currentData.hasOwnProperty(c)){if(JSON.stringify(this.currentData[c])!==JSON.stringify(e[c]))for(var o=0;i>o;o++)e[c].hasOwnProperty(this.keys[o])&&e[c][this.keys[o]]!==this.currentData[c][this.keys[o]]&&this.cell(a,o).text(e[c][this.keys[o]])}else{n=viewMachine("tr");for(var v=0;i>v;v++)e[c].hasOwnProperty(this.keys[v])?(r=e[c][this.keys[v]],Array.isArray(r)&&(r=r.join(", ")),n.append(viewMachine("td",{text:r}))):n.append(viewMachine("td"));this.children[1].splice(a,0,n)}a++}return this.currentData=t,this},headings:function(e,t){this.currentHeadings=t||e;var i={};return i=viewMachine.extend(i,this.currentData),this.children()[0].splice(0,1,new viewMachine.parent("tr","th",this.currentHeadings)),this.data([]),this.keys=e,this.data(i),this},cell:function(e,t){return this.children()[1].children()[e].children()[t]}},viewMachine.Video=function(e,t,i){var n=viewMachine("video",i);for(var r in e)n.append(viewMachine("source",{src:t+"."+e[r],type:"video/"+e[r]}));return n},viewMachine.Image=function(e,t,i){var n=viewMachine("img",viewMachine.extend(i,{src:t,"data-img":e}));n.preload=t,n.src=e;var r=new Image;return r.onload=function(){n.attrs("src",n.data("img"))},r.src=e,n},viewMachine.properties.img=["src","preload"],Template.prototype.ref=function(e,t){this.refs=this.refs||{},this.refs[e]=t},Template.prototype.dataHandler=function(e,t,i){this.data=this.data||{},this.data[e]=viewMachine.schonfinkelize(i,t)},viewMachine.Gen=function(e){this.build=function(){return new Template(e)}};