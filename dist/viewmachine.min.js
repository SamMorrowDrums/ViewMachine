/*! viewmachine 23-02-2014 */
if(void 0===ViewMachine)var ViewMachine={};if(ViewMachine=function(e){"use strict";return e.extend=function(t){t=t||{};for(var r=1;arguments.length>r;r++){var i=arguments[r];if(i){if(Array.isArray(i)){t=[];for(var n=0;i.length>n;n++)"object"==typeof i[n]?(t.push({}),e.extend(t[r],i[r])):t.push(i[r])}for(var s in i)i.hasOwnProperty(s)&&("object"==typeof i[s]?e.extend(t[s],i[s]):t[s]=i[s])}}return t},e.event={},e.addEventListener=function(e,t,r){e.addEventListener?e.addEventListener(t,r):e.attachEvent("on"+t,r)},e.on=function(t,r,i){if("string"!=typeof t||"function"!=typeof r)throw"Type Error: expects, (string, function)";void 0===e.event[t]&&(e.event[t]=[]),e.event[t].push([r,i])},e.trigger=function(t,r){if(void 0!==e.event[t])for(var i={event:t,timestamp:(new Date).getTime()},n=0;e.event[t].length>n;n++)2===e.event[t][n].length&&(i.data=e.event[t][n][1]),e.event[t][n][0](i,r)},e.removeAllListeners=function(t){void 0!==e.event[t]&&delete e.event[t]},e}(ViewMachine),void 0===ViewMachine)var ViewMachine={};if(ViewMachine=function(e){"use strict";var t;return t=function(r,i){var n,s,a,p,o,h;if("[object Array]"===Object.prototype.toString.call(r))for(n=0;r.length>n;n+=1)i.append(t(r[n],i));else if("string"==typeof r)e.makeElement(r);else for(s in r)if(r.hasOwnProperty(s)){switch(-1!==s.indexOf(":")&&(a=s.split(":")),p=void 0!==a?a[0]:s){case"div":o=e.makeElement(void 0!==a?a[0]:s,void 0!==a?a[1]:""),o.append(t(r[s],o));break;case"form":o=e.makeForm(r[s]);break;case"list":o=e.makeList(r[s]);break;case"table":o=e.makeTable(r[s].keyList,r[s].data);break;case"b":case"p":o=e.makeElement(void 0!==a?a[0]:s,void 0!==a?a[1]:""),"[object Array]"!==Object.prototype.toString.call(r[s])&&o.append(r[s]);break;case"img":o=["<img "+(void 0!==a?'class="'+a[1]+'" ':"")+'src="'+r[s]+'" '+(void 0!==a?'title="'+a[1]+'" ':"")+'alt="'+(void 0!==a?a[1]:r[s])+'" />'];break;case"h1":case"h2":case"h3":case"h4":o=e.makeElement(void 0!==a?a[0]:s,void 0!==a?a[1]:""),o.append(e.cleanTitles(r[s]));break;default:o=e.makeElement(void 0!==a?a[0]:s,void 0!==a?a[1]:""),o.append(h)}void 0!==o&&i.append(o)}return i},e.build=function(r){var i,n;return i=r.name,n=e.makeElement("div",i+" view"),n=t(r.structure,n)},e.example={name:"example",structure:[{h1:"The Title"},{div:{div:{p:'This is an <a href="#">example<a/> of paragraph text<br>squirted into a document with <b>inner HTML</b> '},form:e.exampleForm}},{"div:myClass":[{h3:"Sub-title"},{"p:green":"This is a list of paragraphs"}]}]},e}(ViewMachine),void 0===ViewMachine)var ViewMachine={compatability:!1};if(void 0===jQuery&&console.log("Please add JS dependecy jQuery before loading this file."),!ViewMachine.compatability)var VM=ViewMachine;if(ViewMachine=function(e,t){"use strict";var r=[];return e.El=function(e,t){return this.element=e,void 0===t&&(t={}),t.id&&(this.id=t.id),this.drawn=!1,this.properties=t,this.children=[],this.events=[],this.style={},this},e.El.prototype={text:function(e){return this.properties.text=e,this.drawn&&this.draw(),this},getId:function(){return this.id?this.id:""+Math.floor(1e7*Math.random()+1)},html:function(e){this.drawn||(this.properties.id=this.getId()),e&&(this.drawn=!0);var t=document.createElement(this.element);for(var i in this.properties)"text"===i?t.innerHTML=this.properties[i]:"id"===i?t.id=this.properties[i]:t.setAttribute(i,this.properties[i]);for(var n in this.style)t.style[n]=this.style[n];for(var s=this.children.length,a=0;s>a;a++)t.appendChild(this.children[a].html(e));for(var p in this.events)this.events[p].id=this.properties.id,r.push([this.events[p],this]);return t},$:function(){return this.drawn?document.getElementById(this.properties.id):this.html()},draw:function(){function t(t,r,i,n){e.addEventListener(document.getElementById(t),r,function(){e.trigger(i,n)})}if(r=[],this.drawn)this.replace(this.html(!0));else{var i;if("string"==typeof this.parent)i=document.getElementsByTagName(this.parent)[0],i.innerHTML=this.html(!0).outerHTML,this.drawn=!0;else{if(this.parent.drawn!==!0)throw"DrawError: Parent element not on page";i=document.getElementById(this.parent.properties.id),i.appendChild(this.html(!0)),this.drawn=!0}}for(var n=r.length,s=0;n>s;s++)"function"==typeof r[s][0].callback?e.addEventListener(document.getElementById(r[s][0].id),r[s][0].event,r[s][0].callback):t(r[s][0].id,r[s][0].event,r[s][0].callback,r[s][1]);return this},event:function(t,r){if(this.events.push({event:t,callback:r}),"function"==typeof r)this.drawn&&e.addEventListener(document.getElementById(this.properties.id),t,r);else if("string"==typeof r&&this.drawn){var i=this;e.addEventListener(document.getElementById(this.properties.id),t,function(){e.trigger(r,i)})}},remove:function(){if(this.drawn&&(t("#"+this.properties.id).remove(),this.drawn=!1),this.properties.id=this.getId(),"string"!=typeof this.parent){this.getId();for(var e=this.parent.children,r=e.length,i=0;r>i;i++)e[i].properties.id===this.properties.id&&this.parent.children.splice(i,1)}return this},replace:function(e){return this.drawn?(t("#"+this.properties.id).replaceWith(e),this):void 0},hide:function(){return this.drawn&&(t("#"+this.properties.id).remove(),this.drawn=!1),this},append:function(e){return e.parent=this,this.children.push(e),this.drawn&&e.draw(),this},prepend:function(e){return e.parent=this,this.children=[e].concat(this.children),this.drawn&&this.draw(),this},splice:function(e,r,i){var n;if(i?(i.parent=this,n=this.children.splice(e,r,i),this.drawn&&(e>0?(t("#"+this.children[e-1].properties.id).after(i.html()),i.drawn=!0):(t("#"+this.properties.id).append(i.html()),i.drawn=!0))):n=this.children.splice(e,r),this.drawn)for(var s=n.length,a=0;s>a;a++)n[a].remove();return this},css:function(e,t){if("string"==typeof e){if(void 0===t)return this.style[t];this.style[e]=t,this.drawn&&(document.getElementById(this.properties.id).style[e]=t)}else for(var r in e)this.style[r]=e[r],this.drawn&&(document.getElementById(this.properties.id).style[r]=e[r]);return this},parent:"body",type:"ViewMachine"},e.ParentEl=function(t,r,i){var n,s,a=t;if(t.properties&&(s=t.properties,a=t.type),n=new e.El(a,s),"number"==typeof i)for(var p=0;i>p;p++)n.append(new e.El(r));else if(Array.isArray(i))for(var o,h=i.length,l=0;h>l;l++)o="object"==typeof i[l]?"ViewMachine"===i[l].type?i[l]:new e.El(r,i[l]):new e.El(r,{text:i[l]}),n.append(o);return n},e.getKeys=function(t,r){var i,n,s,a,p={};for(n in r)if(r.hasOwnProperty(n))if("[object Array]"!==Object.prototype.toString.call(r[n])&&-1!==t.indexOf(n))if("object"==typeof r[n]){i=[];for(s in r[n])r[n].hasOwnProperty(s)&&i.push(s);p[n]=i.join(", "),a=e.getKeys(t,r[n]);for(s in a)a.hasOwnProperty(s)&&(p[s]=a[s])}else p[n]=r[n];else if(r.hasOwnProperty(n)&&"[object Array]"===Object.prototype.toString.call(r[n]))p[n]=r[n].join(", ");else if("object"==typeof r[n]){a=e.getKeys(t,r[n]);for(s in a)a.hasOwnProperty(s)&&(p[s]=a[s])}return p},e.createTemplate=function(r){var i={};if("object"==typeof r&&"ViewMachine"===r.type){if(i.element=r.element,t.isEmptyObject(r.style)||(i.style=r.style),void 0!==r.id&&(i.id=r.id),!t.isEmptyObject(r.properties))for(var n in r.properties)void 0!==r.properties[n]&&"id"!==n&&(i.properties=i.properties||{},i.properties[n]=r.properties[n]);if(!r.children.length||void 0!==r.preserve&&r.preserve!==!0)r.preserve===!1&&(i.preserve=!1);else{i.children=[];for(var s in r.children)"object"==typeof r&&"ViewMachine"===r.type&&i.children.push(e.createTemplate(r.children[s]))}if(e.properties[r.element])for(var a in e.properties[r.element])"object"==typeof r[e.properties[r.element][a]]?(i[e.properties[r.element][a]]=Array.isArray(r[e.properties[r.element][a]])?[]:{},e.extend(i[e.properties[r.element][a]],r[e.properties[r.element][a]])):i[e.properties[r.element][a]]=r[e.properties[r.element][a]];if(r.events.length){i.events=[];for(var p in r.events)"string"==typeof r.events[p].callback&&i.events.push({event:r.events[p].event,callback:r.events[p].callback})}return i}return!1},e.construct=function(t){var r;if(t.preserve===!1)r=new(e[t.element.substring(0,1).toUpperCase()+t.element.substring(1,t.element.length)])(t[e.properties[t.element][0]],t[e.properties[t.element][1]],t[e.properties[t.element][2]],t[e.types[t.element][3]]);else{if(r="img"===t.element&&"string"==typeof t.preload?new e.Image(t.src,t.preload,t.properties):new e.El(t.element,t.properties),e.properties[r.element])for(var i in e.properties[r.element])"object"==typeof r[e.properties[r.element][i]]?(r[e.properties[r.element][i]]={},e.extend(r[e.properties[r.element][i]],t[e.properties[r.element][i]])):r[e.properties[r.element][i]]=t[e.properties[r.element][i]];e.types[r.element]&&e.extend(r,e.types[r.element])}for(var n in t.children)r.append(e.construct(t.children[n]));return t.style&&(r.style=t.style),void 0!==t.id&&(r.id=t.id),void 0!==t.events&&(r.events=t.events),r},e.jsonTemplate=function(t){if("string"==typeof t){var r=JSON.parse(t);return e.construct(r)}return"object"==typeof t&&"ViewMachine"===t.type&&(t=e.createTemplate(t)),JSON.stringify(t)},e}(ViewMachine,jQuery),void 0===ViewMachine)var ViewMachine={};ViewMachine=function(e){"use strict";return e.types=e.types||{},e.properties=e.properties||{},e.List=function(t){var r="ul",i=t;return t.parent&&(r={type:"ul",properties:t.parent},i=t.children),e.ParentEl(r,"li",i)},e.Select=function(t){var r="select",i=t;return t.parent&&(r={type:"select",properties:t.parent},i=t.children),e.ParentEl(r,"option",i)},e.Table=function(t,r,i){var n,s,a=new e.El("table"),p=new e.El("thead"),o=new e.El("tbody"),h=r.length,l=i||r;a.currentHeadings=l,p.append(new e.ParentEl("tr","th",l));for(var d in t)if(t.hasOwnProperty(d)){n=new e.El("tr");for(var c=0;h>c;c++)s=t[d][r[c]],Array.isArray(s)&&(s=s.join(", ")),n.append(new e.El("td",{text:s}));o.append(n)}return a.children.push(p),a.append(o),a.preserve=!1,a.keys=r,e.extend(a,e.types.table),a.currentData={},a.currentData=e.extend(a.currentData,t),a},e.properties.table=["currentData","keys","currentHeadings"],e.types.table={data:function(t){var r,i=this.keys.length;r=Array.isArray(t)?[]:{};var n,s,a=0,p=0;for(var o in this.currentData)void 0===t[o]?p++:(p>0&&this.children[1].splice(a,p),a++,p=0);p>0&&this.children[1].splice(a,p),a=0;for(var h in t)if(t.hasOwnProperty(h)){if(r[h]=t[h],this.currentData.hasOwnProperty(h)){if(JSON.stringify(this.currentData[h])!==JSON.stringify(t[h]))for(var l=0;i>l;l++)t[h].hasOwnProperty(keys[l])&&t[h][keys[l]]!==this.currentData[h][this.keys[l]]&&this.cell(a,l).text(t[h][this.keys[l]])}else{n=new e.El("tr");for(var d=0;i>d;d++)t[h].hasOwnProperty(this.keys[d])?(s=t[h][this.keys[d]],Array.isArray(s)&&(s=s.join(", ")),n.append(new e.El("td",{text:s}))):n.append(new e.El("td"));this.children[1].splice(a,0,n)}a++}return this.currentData=r,this},headings:function(t,r){this.currentHeadings=r||t;var i={};return i=e.extend(i,this.currentData),this.children[0].splice(0,1,new e.ParentEl("tr","th",this.currentHeadings)),this.data([]),this.keys=t,this.data(i),this},cell:function(e,t){return this.children[1].children[e].children[t]}},e.Video=function(t,r,i){var n=new e.El("video",i);for(var s in t)n.append(new e.El("source",{src:r+"."+t[s],type:"video/"+t[s]}));return n},e.Image=function(t,r,i){var n=new e.El("img",{src:r,"data-img":t});n.preload=r,n.src=t;for(var s in i)n.properties[s]=i[s];var a=new Image;return a.onload=function(){n.properties.src=n.properties["data-img"],n.drawn&&n.draw()},a.src=t,n},e.properties.img=["src","preload"],e}(ViewMachine,jQuery);